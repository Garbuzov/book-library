/*! backbone-library 27-01-2015 */
var app=app||{};app.Book=Backbone.Model.extend({defaults:{coverImage:"img/placeholder.png",title:"No title",author:"Unknown",releaseDate:"Unknown",keywords:"None"},parse:function(a){return a.id=a._id,a}}),app.Library=Backbone.Collection.extend({model:app.Book,url:"/api/books"}),app.BookView=Backbone.View.extend({tagName:"div",className:"bookContainer",template:_.template($("#bookTemplate").html()),events:{"click .delete":"deleteBook"},render:function(){return this.$el.html(this.template(this.model.attributes)),this},deleteBook:function(){this.remove(),this.model.destroy()}}),app.LibraryView=Backbone.View.extend({el:"#books",events:{"click #add":"addBook"},initialize:function(){this.collection=new app.Library,this.collection.fetch({reset:!0}),this.render(),this.listenTo(this.collection,"add",this.renderBook),this.listenTo(this.collection,"reset",this.render)},render:function(){this.collection.each(function(a){this.renderBook(a)},this)},renderBook:function(a){var b=new app.BookView({model:a});this.$el.append(b.render().el)},addBook:function(a){a.preventDefault();var b={};$("#addBook div").children("input").each(function(a,c){""!==$(c).val()&&("keywords"===c.id?(b[c.id]=[],_.each($(c).val().split(" "),function(a){b[c.id].push({keyword:a})})):b[c.id]="releaseDate"===c.id?$("#releaseDate").datepicker("getDate").getTime():$(c).val())}),this.collection.create(b)}}),$(function(){$("#releaseDate").datepicker(),new app.LibraryView});